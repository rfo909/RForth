(Editor content is linked list of references to words)

: ret? IMMEDIATE
  0xC2 EmitByte   (numeric 2 = offset)
  0x36 EmitByte   (rfwd?)
  0x52 EmitByte   (ret)
;

: DIS GetNextWord &NextWord ?C NATIVE Sys.Dis ;


(Test using a global list of symbols)

0 VARIABLE SymbolFirst

: Find ( "&NextWord" -- addr|null )

  SymbolFirst => ptr
  
  BEGIN
    (if ptr==0 return 0)
    0 ptr not ret? drop

    (if match return str-pointer)
    ptr CELL+ @ => s
    s dup &NextWord streq 
    	ret? drop
  
    ptr @ => ptr (ptr=ptr.next)
    1 AGAIN?
;


: Add ( "&NextWord" -- addr )
  (if Find != 0 return that value)
  Find dup ret? drop

  &NextWord BufCreateCopy => ptr
  2 CELLS allot => cons
  SymbolFirst cons !
  ptr cons CELL+ !
  cons SymbolFirst !
  ptr
;

: InputLoop
  BEGIN
     GetNextWord 
     &NextWord "q streq ret?
     cr Add print
  1 AGAIN?
;

#END

(Special pointer values)



0 CONSTANT EDIT_EOF
1 CONSTANT EDIT_NEWLINE
2 CONSTANT EDIT_COLON

0 VARIABLE EDITOR_FIRST_SYMB
0 VARIABLE EDITOR_CURR

