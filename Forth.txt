
Dict EEPROM
EEPROM DictUse

32 CONSTANT BufSize
  
0x50 CONSTANT deviceAddr

800 CONSTANT BufCount
  (with room for dumping HEAP)

HERE BufSize 3 + allot CONSTANT Block 
  (1 length byte 2 eeprom write address bytes)

: Len Block readb ;

: >Byte (byte --) 
  (byte) Block Len + 1+ writeb 
  Len 1+ Block writeb (update length) ;
  
: >Word (val--) 
  dup 
  (val) 8 >> 0xFF & >Byte 
  (val) 0xFF & >Byte 
  ;

: Clr 
  0 Block writeb ;
  
: eeAddr (blockNo) 
  BufSize * ;
  
: InitBlock (blockNo) => b
  Clr b eeAddr >Word b 1 - >Word 0 >Byte ;

: W
  (write Block data to i2c device)
  Block 1+ (ptr)
    Len
    deviceAddr NATIVE I2C.MasterWrite 
  deviceAddr NATIVE I2C.MasterWWait
  ;
  
: InitAll (--) 
  1 => i BEGIN 
    cr i print#
    i InitBlock W
    i 1+ => i 
    i BufCount < AGAIN? ;

: Show (-- show Block data --)
  0 => i BEGIN
     cr i print#
     "_:_ .str
     Block 1+ i + readb print
     i 1+ => i
     i Len < AGAIN?
  ;
  
: >>addr (blockNo)
  Clr (blockNo) eeAddr >Word W ;
    
: R (blockNo)
  Clr (blockNo) eeAddr >Word W
  3 (count) 
    Block 1+ (ptr)
    deviceAddr NATIVE I2C.MasterRead => recv
  recv Block writeb (update length)
  ;

: R1 (addr) => addr
  addr .
  Clr addr >Word W
  1 Block 1+ deviceAddr NATIVE I2C.MasterRead 
  cr Block 1+ print
  0 Block writeb
  ;
  

HERE 4128 - .

#END



