(
Letting #buf indicate a buffer that
has the length byte set to the size of 
the buffer
)

: fillSpaces (#buf) 
  => buf
  buf readb 1 - => pos
  BEGIN 
    0x20 buf pos + 1+ writeb
    pos 1 - => pos
    pos AGAIN? ;

: CRLF? (ch) dup 13 == swap 10 == || ;
  
: readLine (#buf)
  dup fillSpaces 
  dup readb => len
  => buf
  0 => pos
  0 => c (can't use variable first time inside loop)
  BEGIN
    readc => c
    cr c print#
    c CRLF?
      pos buf readb >= || 
      IF ret THEN
    c buf pos + 1+ writeb
    pos 1+ => pos  
    1 AGAIN?
;

(
test
)

HERE 29 allot CONSTANT buf
28 buf writeb
buf fillSpaces

: dump
  0 => i
  cr
  BEGIN
    buf i + 1+ readb print "_ .str
    i 1+ => i
    i 28 < AGAIN?
;

( ** it works ** )

#END


